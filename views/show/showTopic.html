{{extend 'layout.html'}}

{{=A('Back', _href=URL('default', 'viewCourseTopic', args=topic.board_id))}}
{{op = db.auth_user[topic.op]}}
{{name = op.first_name+ " " +op.last_name}}
<div class="container">
	<div class="panel-group">
		<div class="panel panel-default">
	    	<div class="panel-heading">
	    		<h2><p class="text-primary text-capitalize">{{=A(name, 
	    			_href=URL('userProfile','showProfile',args=[op.id], 
	    			vars=dict(controller=request.controller,function=request.function,args=request.args)))}}:
	    			{{=topic.title}}
	    		</p></h2>
	        		{{=topic.datePosted.strftime("%d, %b %Y %I:%M %p")}}
	        </div>
	        <div class="panel-body">
	        	{{=topic.body}}
	        </div>
	        <div class="panel-footer">
	        	<!--<p class="text-capitalize">{{=A('Reply', _href=URL('create', 'createReply', args=topic.id))}}</p>-->
	       	<p class="text-capitalize"><a href="#" data-toggle="modal" data-target="#bannerformmodal">Reply</a></p>
            <div class="modal fade bannerformmodal" tabindex="-1" role="dialog" aria-labelledby="bannerformmodal" aria-hidden="true" id="bannerformmodal">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h4 class="modal-title"><p class="text-capitalize">Reply to {{=name}}</p></h4>
                         </div>
                        <div class="modal-body">
                          {{=form}}
                        </div>
                    </div>
                </div>
            </div>
	        </div>
		</div>
	</div>
	
	{{replies = db(db.courseReply.topic_id==topic.id).select()}}
	{{for reply in replies:}}
		{{op = db.auth_user[reply.replyOp]}}
		{{name = op.first_name+ " " +op.last_name}}
		<div class="panel-group">
			<div class="panel panel-default">
				<div class="panel-heading">
					<p class="text-capitalize">{{=A(name, 
						_href=URL('userProfile','showProfile',args=[op.id], 
						vars=dict(controller=request.controller,function=request.function,args=request.args)))}}
						<br>
						{{=reply.datePosted.strftime("%d, %b %Y %I:%M %p")}}
					</p>
				</div>
				<div class="panel-body">
					{{=reply.body}}
					<br>
					{{=reply.id}}
				</div>
				<div class="panel-footer">
					<!--<p class="text-capitalize">{{=A('Quick Reply', _href=URL('create', 'createReplyReply', args=reply.id))}}</p>-->
					<p class="text-capitalize"><a href="#" data-toggle="modal" data-target="#bannerformmodal2">Quick Reply</a></p>

					{{quickReplies = db(db.courseTopicReply.topic_id==reply.id).select()}}
					{{for qr in quickReplies:}}
						{{op = db.auth_user[qr.replyOp]}}
						{{name = op.first_name+ " " +op.last_name}}
						<p class="text-capitalize">{{=A(name, 
							_href=URL('userProfile','showProfile',args=[op.id], 
							vars=dict(controller=request.controller,function=request.function,args=request.args)))}}: {{=qr.body}} <br> {{=reply.id}}
						</p>
						<div class="modal fade" tabindex="-1" role="dialog" id="bannerformmodal2">
						    <div class="modal-dialog">
						        <div class="modal-content">
						            <div class="modal-header">
						                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
						                <h4 class="modal-title"><p class="text-capitalize">Reply {{=reply.id}}</p></h4>
						             </div>
						            <div class="modal-body">
						              {{=form2}}
						            </div>
						        </div>
						    </div>
						</div>
					{{pass}}
				</div>
			</div>
		</div>
	{{pass}}
</div>